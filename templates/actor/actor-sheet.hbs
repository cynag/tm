<form class="{{cssClass}}" autocomplete="off">

  <!-- HEADER -->
  <header class="sheet-header">
    <div style="display: flex; align-items: center; gap: 10px;">
      <img src="{{actor.img}}" data-edit="img" width="64" height="64" style="flex-shrink: 0;" />
      <h1 class="charname" style="flex: 1;">
        <input name="name" type="text" value="{{actor.name}}" placeholder="Nome do Personagem" />
      </h1>
    </div>
  </header>

  <!-- BODY -->
  <section class="sheet-body" style="padding: 10px; display: flex; flex-direction: column; gap: 20px;">

    <!-- EXEMPLO DE CAMPOS (HP / AP) -->
    <div>
      <h2>Pontos Vitais</h2>
      <div style="display: flex; gap: 20px;">
        <div>
          <label>HP:</label>
          <input type="number" name="system.hp_value.value" value="{{system.hp_value.value}}" style="width: 50px;" />
          /
          <input type="number" name="system.hp_value.max" value="{{system.hp_value.max}}" style="width: 50px;" />
        </div>
        <div>
          <label>AP:</label>
          <input type="number" name="system.ap_value.value" value="{{system.ap_value.value}}" style="width: 50px;" />
          /
          <input type="number" name="system.ap_value.max" value="{{system.ap_value.max}}" style="width: 50px;" />
        </div>
      </div>
    </div>

    <!-- INVENTORY GRID -->
    <div style="display: flex; flex-direction: column; align-items: center;">
      <h2>Inventário</h2>

      <!-- Botão Organizar -->
      <button type="button" class="inventory-sort" style="margin-bottom: 10px;">Organizar Inventário</button>

      <div class="inventory-grid"
           data-grid-width="10"
           data-grid-height="5"
           style="
             display: grid;
             grid-template-columns: repeat(10, 50px);
             grid-template-rows: repeat(5, 50px);
             gap: 0px;
             outline: 2px solid #555;
             padding: 0px;
             position: relative;
             box-sizing: border-box;
             width: calc(10 * 50px);
             height: calc(5 * 50px);
             background-color: #1a1a1a !important;
             background-image: 
               linear-gradient(to right, rgba(255, 255, 255, 0.15) 1px, transparent 1px),
               linear-gradient(to bottom, rgba(255, 255, 255, 0.15) 1px, transparent 1px);
             background-size: 50px 50px;
             background-origin: content-box;
             background-position: top left;
             overflow: visible; /* importante: evitar clipping */
           ">

        <!-- INVENTORY GRID SEM LOOP DUPLO -->

<div class="inventory-grid"
     data-grid-width="10"
     data-grid-height="5"
     style="
       display: grid;
       grid-template-columns: repeat(10, 50px);
       grid-template-rows: repeat(5, 50px);
       gap: 0px;
       outline: 2px solid #555;
       padding: 0px;
       position: relative;
       box-sizing: border-box;
       width: calc(10 * 50px);
       height: calc(5 * 50px);
       background-color: #1a1a1a !important;
       background-image: 
         linear-gradient(to right, rgba(255, 255, 255, 0.15) 1px, transparent 1px),
         linear-gradient(to bottom, rgba(255, 255, 255, 0.15) 1px, transparent 1px);
       background-size: 50px 50px;
       background-origin: content-box;
       background-position: top left;
       overflow: visible;
     ">

  <!-- LINHAS DE GRID (opcional, só visual) -->
  {{#each (range 0 4) as |cellY|}}
    {{#each (range 0 9) as |cellX|}}
      <div class="inventory-cell"
           data-cell-x="{{cellX}}"
           data-cell-y="{{cellY}}"
           style="
             grid-column: {{add cellX 1}};
             grid-row: {{add cellY 1}};
             border: 1px solid rgba(255,255,255,0.1);
             position: relative;
           ">
      </div>
    {{/each}}
  {{/each}}

  <!-- ITENS RENDERIZADOS -->
  {{#each resolvedItems as |item|}}
    {{#unless (eq ../pickupItemId item._id)}}

      {{debug "RENDER ITEM" item=item}}

      <div class="grid-item"
           data-item-id="{{item._id}}"
           draggable="true"
           style="
             grid-column: {{add item.system.gridX 1}} / span {{item.system.gridWidth}};
             grid-row: {{add item.system.gridY 1}} / span {{item.system.gridHeight}};
             box-shadow: inset 0 0 0 1px red;
             background-color: rgba(255,255,255,0.2);
             display: flex;
             align-items: center;
             justify-content: center;
             cursor: grab;
             position: relative;
           ">

        <div class="grid-item-image-wrapper"
          {{#if item.system.rotated}}
            {{#unless (eq item.system.gridWidth item.system.gridHeight)}}
              style="transform: rotate(90deg); transform-origin: center center;"
            {{/unless}}
          {{/if}}>
          <img src="{{item.img}}"
               style="max-width: 100%; max-height: 100%; object-fit: contain;" />
        </div>

      </div>

    {{/unless}}
  {{/each}}

</div>


      </div> <!-- .inventory-grid -->

    </div>

  </section>
</form>
